<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/HistoriaHeader.css">
    <link rel="stylesheet" href="css/Historia.css">
    <link rel="stylesheet" href="css/gerais.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<!-- <body  onload="validarSessao(), atualizarFeed()"> -->
  <body onload="atualizarFeed()" style="background-color: #161618;">
    <header class="headerhistoria">
        <div class="containerHistoria">
          <div class="titulo">
            <h1><a href="index.html">Criminal Minds</a></h1>
          </div>

          <div class="navegacaoHistoria">
            <ul>

                <li><a href="#serie">Serie</a></li>
                <li><a href="#personagem">Personagem</a></li>
                <li><a href="#id_votacao">Votação</a></li>
                <li>|</li>
                <li><a href="login.html">Login</a></li>
                <li><a href="index.html">Sair</a></li>

            </ul>

          </div>

        </div>

    </header>

<main>
    <div class="container2">

        <div class="dimencao">

          <div class="texto">

            <p style="color: rgb(255, 255, 255);" Align="justify">

              Bem vindo <span id="b_usuario"></span>, esse e o nosso blog da serie Criminal Minds e voçê podera aqui saber alguns informaçõs sobre os principais personagem e das tempordas. <br>
              Voçê também pode fazer parte das votaçoes e acoampanha qual personagem ou serie as pessoas mais gosta. <br>
              Aqui também voçê podera comentar sobre o seu personagem ou temporada. <br>
              Espero que goste se divirta :)

            </p>
          </div>

            <div class="dimencao1" id="personagem" Align="justify">

                <div class="campo">

                  <div class="foto">
                    <img src="./assets/img/Aaron Hotchner.webp" alt="aaron" >
                  </div>

                    <div class="descricao">
                      <li>O Personagem <b>Aaron Hotchner</b> é o ex-chefe de unidade da Unidade de Análise Comportamental de Quantico , o superior direto de todos os agentes especiais e o Oficial de Ligação de Mídia da equipe </li>
                    </div>

                </div>


                <div class="campo">

                  <div class="foto">

                    <img src="./assets/img/David-Rossi.jpg" alt="divid" width="100px">
                  </div>

                    <div class="descricao">
                      <li>O Personagem <b>David Rossi</b> Lorem ipsum dolor sit amet consectetur adipisicing elit. Delectus ullam quae aspernatur nesciunt placeat? Earum aliquid magnam animi et quod non, ratione suscipit delectus quidem obcaecati tempore, dolorem minus! </li>
                    </div>

                </div>


                <div class="campo">

                  <div class="foto">
                  
                    <img src="./assets/img/Space.jpg" alt="spacer" >
                  </div>

                    <div class="descricao">
                      <li>O Personagem <b>Spencer Reid</b> é um Agente Especial de Supervisão da BAU . Ele é saudado como um gênio e um autodidata. </li>
                    </div>

                </div>

              </div>


  
            <div class="dimencao1" Align="justify">

                <div class="campo">

                  <div class="foto">
                    <img src="./assets/img/penelopegarcia.jpg" alt="penelope" >
                  </div>

                    <div class="descricao">
                      <li>O Personagem <b>Penelope Garcia</b> Lorem ipsum dolor sit amet consectetur adipisicing elit. Delectus ullam quae aspernatur nesciunt placeat? Earum aliquid magnam animi et quod non, ratione suscipit delectus quidem obcaecati tempore, dolorem minus! </li>
                    </div>

                </div>


                <div class="campo">

                  <div class="foto">
                    <img src="./assets/img/Darick-Morgan.jpg" alt="darick">
                  </div>

                    <div class="descricao">
                      <li>O Personagem <b>Derek Morgan</b> Lorem ipsum dolor sit amet consectetur adipisicing elit. Delectus ullam quae aspernatur nesciunt placeat? Earum aliquid magnam animi et quod non, ratione suscipit delectus quidem obcaecati tempore, dolorem minus! </li>
                    </div>

                </div>


                <div class="campo">

                  <div class="foto">
                    <img src="./assets/img/Emilly.webp" alt="Emilly">
                  </div>

                    <div class="descricao">
                      <li>O Personagem <b>Emily Prentiss</b> Lorem ipsum dolor sit amet consectetur adipisicing elit. Delectus ullam quae aspernatur nesciunt placeat? Earum aliquid magnam animi et quod non, ratione suscipit delectus quidem obcaecati tempore, dolorem minus! </li>
                    </div>

                </div>

              </div>


                <div class="dimencao1" Align="justify">

                <div class="campo">

                  <div class="foto">
                    <img src="./assets/img/JJ.webp" alt="jj">
                  </div>
                  
                    <div class="descricao">
                      <li>O Personagem <b>Jennifer Jareau</b> Lorem ipsum dolor sit amet consectetur adipisicing elit. Delectus ullam quae aspernatur nesciunt placeat? Earum aliquid magnam animi et quod non, ratione suscipit delectus quidem obcaecati tempore, dolorem minus! </li>
                    </div>

                </div>

                <div class="campo">

                  <div class="foto">
                    <img src="./assets/img/Jason.jpg" alt="jason">
                  </div>

                    <div class="descricao">
                      <li>O Personagem <b>Jasin Gideon</b> Lorem ipsum dolor sit amet consectetur adipisicing elit. Delectus ullam quae aspernatur nesciunt placeat? Earum aliquid magnam animi et quod non, ratione suscipit delectus quidem obcaecati tempore, dolorem minus! </li>
                    </div>

                </div>


                <div class="campo">

                  <div class="foto">
                    <img src="./assets/img/Kete.webp" alt="kate">
                  </div>

                    <div class="descricao" >
                      <li>O Personagem <b>Kate Callahan</b> Lorem ipsum dolor sit amet consectetur adipisicing elit. Delectus ullam quae aspernatur nesciunt placeat? Earum aliquid magnam animi et quod non, ratione suscipit delectus quidem obcaecati tempore, dolorem minus ! </li>
                    </div>

                </div>

            </div>


            <div class="conteinerVotacao" style="border-bottom: 2px solid #fff;"  id="id_votacao"> 

                <h3>FAÇA SUA VOTAÇÃO, DE QUEM VOCÊ GOSTA MAIS</h3>

                <div class="voto">
                  <form id="id_votacao" onsubmit="return publicarVotos()">
                  <div id="div_voto" class="img_votos"></div>
                  <button>Enviar</button>
                </form>
            </div>


            <h2>CAPA DAS TEMPORADAS</h2>
                
                <div class="carrossel">
                   <div id="id_carrossel" class="campo_carrossel">
                 
                  </div> 
                  
                </div>

                <!--MURAL DE AVISO -->
                <form id="form_postagem" method="post" onsubmit="return publicar()" class="campo_comentario">
                  
                  <label>
                      Título do seu comentario:
                      <br>
                      <input name="titulo" id="titulo" maxlength="100" type="text">
                  </label>

                  <br>

                  <label>
                      Descrição (máximo de 250 caracteres):
                      <br>
                      <textarea name="descricao" id="textarea_descricao" maxlength="250" rows="5"></textarea>
                  </label>

                        <br>
                        <button>Enviar</button>

                    </form>


                <h1>Mural de Avisos</h1>

                <div class="div-results">
                    <div id="feed_container" class="feed-container">
                    </div>
                </div>

        </div>
          
        </div>
    </div>
</main>
  <!-- FOOTER/RODAPÉ  -->
  <footer>

    <div class="rodape">
      <p>Criminal Minds&copy;</p>
    </div>

  </footer>


</body>
</html>


<script>
  // carrossel


  const imagem_carrossel = 
  [
    "./assets/./img/T1.webp"
    ,
    "./assets/./img/T2.webp"
    ,
    "./assets/./img/T3.webp"
    ,
    "./assets/./img/T4.webp"
    ,
    "./assets/./img/T5.webp"
    ,
    "./assets/./img/T6.webp"
    ,
    "./assets/./img/T7.webp"
    ,
    "./assets/./img/T8.webp"
    ,
    "./assets/./img/T9.webp"
    ,
    "./assets/./img/T10.webp"
    ,
    "./assets/./img/T11.webp"
    ,
    "./assets/./img/T12.webp"
    ,
    "./assets/./img/T13.webp"
    ,
    "./assets/./img/T14.webp"
    ,
    "./assets/./img/T15.webp"
  ];

  var intervalo = 0;

  function carrosselfun(){
  
    for(var l = 0; l < imagem_carrossel.length; l++){

      for( var i = 0; i < imagem_carrossel.length; i++){
        id_carrossel.innerHTML = `<img src="${imagem_carrossel[l]}" display: none;  >`;

    }

    id_carrossel.innerHTML = `<img src="${imagem_carrossel[l]}" display: block;  >`;
      intervalo++

    if(intervalo >= imagem_carrossel.length){
      intervalo = 0;
    }
  }

   // id_carrossel.innerHTML = `<img src="${imagem_carrossel.length}" display: block;  >`;

   

  }

  setInterval(carrosselfun(), 4000);
  

  //setInterval(function carrosselfun(){
  //  for( var i = 0; i < imagem_carrossel.length; i++){
//
  //  id_carrossel.innerHTML = `<img src="${imagem_carrossel[i]}" >`;
  //  }
  //},5000)
  // var i = 0

  // while(i < imagem_carrossel.length){

  //   id_carrossel.innerHTML = `<img src="${imagem_carrossel[i]}" >`;
  //    setInterval(i++,5000) }

</script>



<!-- COMENTARIO -->
<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

function limparFormulario() {
    document.getElementById("form_postagem").reset();
}

function publicar() {
    var idUsuario = sessionStorage.ID_USUARIO;

    var corpo = {
        titulo: form_postagem.titulo.value,
        descricao: form_postagem.descricao.value
    }

    fetch(`/avisos/publicar/${idUsuario}`, {
        method: "post",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(corpo)
    }).then(function (resposta) {

        console.log("resposta: ", resposta);

        if (resposta.ok) {
            window.alert("Post realizado com sucesso pelo usuario de ID: " + idUsuario + "!");
            window.location = "./historia.html";
            limparFormulario();
            finalizarAguardar();
        } else if (resposta.status == 404) {
            window.alert("Deu 404!");
        } else {
            throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
        }
    }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        //finalizarAguardar();
    });

    return false;

}

function editar(idAviso) {
    sessionStorage.ID_POSTAGEM_EDITANDO = idAviso;
    console.log("cliquei em editar - " + idAviso);
    window.alert("Você será redirecionado à página de edição do aviso de id número: " + idAviso);
    window.location = "/dashboard/edicao-aviso.html"

}

function deletar(idAviso) {
    console.log("Criar função de apagar post escolhido - ID" + idAviso);
    fetch(`/avisos/deletar/${idAviso}`, {
        method: "DELETE",
        headers: {
            "Content-Type": "application/json"
        }
    }).then(function (resposta) {

        if (resposta.ok) {
            window.alert("Post deletado com sucesso pelo usuario de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
            window.location = "/historia.html"
        } else if (resposta.status == 404) {
            window.alert("Deu 404!");
        } else {
            throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
        }
    }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
    });
}

function atualizarFeed() {
    //aguardar();
    fetch("/avisos/listar").then(function (resposta) {
        if (resposta.ok) {
            if (resposta.status == 204) {
                var feed = document.getElementById("feed_container");
                var mensagem = document.createElement("span");
                mensagem.innerHTML = "Nenhum resultado encontrado."
                feed.appendChild(mensagem);
                throw "Nenhum resultado encontrado!!";
            }

            resposta.json().then(function (resposta) {
                console.log("Dados recebidos: ", JSON.stringify(resposta));

                var feed = document.getElementById("feed_container");
                feed.innerHTML = "";
                for (let i = 0; i < resposta.length; i++) {
                    var publicacao = resposta[i];

                    // criando e manipulando elementos do HTML via JavaScript
                    var divPublicacao = document.createElement("div");
                    var spanID = document.createElement("span");
                    var spanTitulo = document.createElement("span");
                    var spanNome = document.createElement("span");
                    var divDescricao = document.createElement("div");
                    var divButtons = document.createElement("div");
                    var btnEditar = document.createElement("button");
                    var btnDeletar = document.createElement("button");


                    spanID.innerHTML = "ID: <b>" + publicacao.idAviso + "</b>";
                    spanTitulo.innerHTML = "Título: <b>" + publicacao.titulo + "</b>";
                    spanNome.innerHTML = "Autor: <b>" + publicacao.nome + "</b>";
                    divDescricao.innerHTML = "Descrição: <b>" + publicacao.descricao + "</b>";
                    btnDeletar.innerHTML = "Deletar";

                    divPublicacao.className = "publicacao";
                    spanTitulo.id = "inputNumero" + publicacao.idAviso;
                    spanNome.className = "publicacao-nome";
                    spanTitulo.className = "publicacao-titulo";
                    divDescricao.className = "publicacao-descricao";

                    divButtons.className = "div-buttons"

                    btnEditar.className = "publicacao-btn-editar"
                    btnEditar.id = "btnEditar" + publicacao.idAviso;
                    btnEditar.setAttribute("onclick", `editar(${publicacao.idAviso})`);

                    btnDeletar.className = "publicacao-btn-editar"
                    btnDeletar.id = "btnDeletar" + publicacao.idAviso;
                    btnDeletar.setAttribute("onclick", `deletar(${publicacao.idAviso})`);

                    divPublicacao.appendChild(spanID);
                    divPublicacao.appendChild(spanNome);
                    divPublicacao.appendChild(spanTitulo);
                    divPublicacao.appendChild(divDescricao);
                    divPublicacao.appendChild(divButtons);
                    divButtons.appendChild(btnEditar);
                    divButtons.appendChild(btnDeletar);
                    feed.appendChild(divPublicacao);
                }

                //finalizarAguardar();
            });
        } else {
            throw ('Houve um erro na API!');
        }
    }).catch(function (resposta) {
        console.error(resposta);
        //finalizarAguardar();
    });
}

function testar() {
    //aguardar();

    var formulario = new URLSearchParams(new FormData(document.getElementById("form_postagem")));

    var divResultado = document.getElementById("div_feed");

    divResultado.appendChild(document.createTextNode(formulario.get("descricao")));
    divResultado.innerHTML = formulario.get("descricao");

    //finalizarAguardar();

    return false;
}

   
</script>

<script>
 // //VOTACAO

  const img_votos = [
     {nome:'Aaron Hotchner' ,img:'./assets/img/Aaron Hotchner.webp'},
     {nome:'David-Rossi' ,img:'./assets/img/David-Rossi.jpg'},
     {nome:'Space' ,img:'./assets/img/Space.jpg'},
     {nome:'penelopegarcia' ,img:'./assets/img/penelopegarcia.jpg'},
     {nome:'Darick-Morgan' ,img:'./assets/img/Darick-Morgan.jpg'},
     {nome:'Emilly' ,img:'./assets/img/Emilly.webp'},
     {nome:'JJ' ,img:'./assets/img/JJ.webp'},
     {nome:'Jason' ,img:'./assets/img/Jason.jpg'},
     {nome:'Kate' ,img:'./assets/img/Kete.webp'},
  ]

  for(var q = 0; q < img_votos.length; q++){
    div_voto.innerHTML += `<img onclick="verificar()" id="id_${q}" src="${img_votos[q].img}" alt="${img_votos[q].nome}">`
  }

  var nome_pessonagem = "";

  function verificar(){
    var id = id_ 

    for(var v = 0; v < img_votos.length; v++){

    if( == 0)
    {  
      nome_pessonagem = 'Aaron Hotchner'
      publicarVotos();
      return;
    }
    if(img_votos[v] == 1)
    {
      nome_pessonagem = 'David-Rossi'
      publicarVotos();
      return;
    }
    if(img_votos[v].nome == 'Space' && v == id)
    {
      nome_pessonagem = 'Space'
      publicarVotos();
      return;
    }
    if(img_votos[v].nome == 'penelopegarcia')
    {
      nome_pessonagem = 'penelopegarcia'
      publicarVotos();
      return;
    }
    if(img_votos[v].nome == 'Darick-Morgan')
    {
      nome_pessonagem = 'Darick-Morgan'
      publicarVotos();
      return;
    }
    if(img_votos[v].nome == 'Emilly')
    {
      nome_pessonagem = 'Emilly'
      publicarVotos();
      return;
    }
    if(img_votos[v].nome == 'JJ')
    {
      nome_pessonagem = 'JJ'
      publicarVotos();
      return;
    }
    if(img_votos[v].nome == 'Jason' )
    {
      nome_pessonagem = 'Jason'
      publicarVotos();
      return;
    }
    else if(img_votos[v].nome == 'Kate' )
    {
      nome_pessonagem ='Kate'
      publicarVotos();
      return;
    }
  
    }
  }

  function publicarVotos() {
        var idUsuario = sessionStorage.ID_USUARIO;

        var corpo = {
          nome: nome_pessonagem
        };

        fetch(`/votos/publicar/${idUsuario}`, {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(corpo)
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Post realizado com sucesso pelo usuario de ID: " + idUsuario + "!");
                window.location = "/historia.html";
                limparFormulario();
                finalizarAguardar();
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar o voto! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });

        return false;

    }

  
</script>
