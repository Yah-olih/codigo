<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Criminal Minds</title>
  <link rel="stylesheet" href="css/HistoriaHeader.css">
  <link rel="stylesheet" href="css/Historia.css">
  <link rel="stylesheet" href="css/gerais.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<!-- <body  onload="validarSessao(), atualizarFeed()"> -->

<body onload="atualizarFeedcomentario(), atualizarFeedvotos()" style="background-color: #161618;">
  <header class="headerhistoria">
    <div class="containerHistoria">
      <div class="titulo">
        <h1><a href="index.html">Criminal Minds</a></h1>
      </div>

      <div class="navegacaoHistoria">
        <ul>

          <li><a href="#serie">Serie</a></li>
          <li><a href="#personagem">Personagem</a></li>
          <li><a href="#votacao">Votação</a></li>
          <li>|</li>
          <li><a href="login.html">Login</a></li>
          <li><a href="index.html">Sair</a></li>

        </ul>

      </div>

    </div>

  </header>

  <main>
    <div class="container2">

      <div class="dimencao">

        <div class="texto">

          <p style="color: rgb(255, 255, 255);" Align="justify">

            Bem vindo <span id="b_usuario"></span>, esse e o nosso blog da série Criminal Minds e você poderá aqui saber 
            algumas informações sobre os principais personagens e suas temporadas. <br> 
            Você também pode fazer parte da votação e acompanha qual personagem ou serie as pessoas mais gosta. <br> 
            Aqui também você poderá comentar sobre o seu personagem ou temporada favorita. <br> 
            Espero que goste se divirta :) 

          </p>
        </div>

        <div class="dimencao1" id="personagem" Align="justify">

          <div class="campo">

            <div class="foto">
              <img src="./assets/img/Aaron Hotchner.webp" alt="aaron">
            </div>

            <div class="descricao">
              <li>O Personagem <b>Aaron Hotchner</b> é o ex-chefe de unidade da Unidade de Análise Comportamental de
                Quantico , o superior direto de todos os agentes especiais e o Oficial de Ligação de Mídia da equipe
              </li>
            </div>

          </div>


          <div class="campo">

            <div class="foto">

              <img src="./assets/img/David-Rossi.jpg" alt="divid" width="100px">
            </div>

            <div class="descricao">
              <li>O Personagem <b>David Rossi</b> serviu à na Guerra do Vietnã, e quando mais jovens serviu a máfia local, depois de roupe os laços ele se casou, porém se divorciou, 3x de 3 casamentos diferentes mais nunca foi mostrado os motivos, depois de se aposentar ele começou a dá palestras de serial killer</li> 
            </div>

          </div>


          <div class="campo">

            <div class="foto">

              <img src="./assets/img/Space.jpg" alt="spacer">
            </div>

            <div class="descricao">
              <li>O Personagem <b>Spencer Reid</b> é um Agente Especial de Supervisão da BAU. Ele é saudado como um gênio com um QI de 187 e pode ler 20.000 palavras por minuto com uma memória ele acredita que a mente a mais importante do que uma arma, porém no final da série ele vai embora pois descobre que tem a mesma doença que sua mãe esquizofrenia paranóica </li> 
            </div>

          </div>

        </div>



        <div class="dimencao1" Align="justify">

          <div class="campo">

            <div class="foto">
              <img src="./assets/img/penelopegarcia.jpg" alt="penelope">
            </div>

            <div class="descricao">
              <li>O Personagem <b>Penelope Garcia</b> é a ex-analista técnica da BAU e também a oficial de contato com a mídia da equipe desde a promoção de Jennifer Jareau a agente especial de supervisão; o último é um trabalho que ela compartilhou anteriormente com Aaron Hotchner antes de sua saída do BAU e da série no final da série na décima quinta temporada . </li>
            </div>

          </div>


          <div class="campo">

            <div class="foto">
              <img src="./assets/img/Darick-Morgan.jpg" alt="darick">
            </div>

            <div class="descricao">
              <li>O Personagem <b>Derek Morgan</b> é especialista em fixações e comportamentos obsessivos, servindo brevemente como chefe interino da unidade, ele foi um dos três únicos personagens principais a aparecer desde a primeira temporada como "estrelando" ao mesmo tempo, tornando-se o único personagem a aparecer em todos os episódios.

              </li>
            </div>

          </div>


          <div class="campo">

            <div class="foto">
              <img src="./assets/img/Emilly.webp" alt="Emilly">
            </div>

            <div class="descricao">
              <li>O Personagem <b>Emily Prentiss</b> é um membro de longa data do BAU que se juntou à equipe dois episódios depois que Elle Greenaway renunciou ao FBI para sempre. No final da sétima temporada , ela renunciou ao BAU e aceitou um cargo na Interpol em Londres. </li>
            </div>

          </div>

        </div>


        <div class="dimencao1" Align="justify">

          <div class="campo">

            <div class="foto">
              <img src="./assets/img/JJ.webp" alt="jj">
            </div>

            <div class="descricao">
              <li>O Personagem <b>Jennifer Jareau</b> é uma Agente Especial Supervisora ​​que foi a ex-ligação do BAU com a polícia e funcionários da mídia. Após seu retorno na sétima temporada , ela se torna oficialmente uma criadora de perfis , enquanto sua posição original foi para Aaron Hotchner, também muito proxima do doutor spancer pois e padrinho do seu filho </li>
            </div>

          </div>

          <div class="campo">

            <div class="foto">
              <img src="./assets/img/Jason.jpg" alt="jason">
            </div>

            <div class="descricao">
              <li>O Personagem <b>Jasin Gideon</b> era um criador de perfis criminais, ex-agente especial supervisor sênior da Unidade de Análise Comportamental do FBI. No início da terceira temporada, Gideon se aposentou abruptamente do BAU devido a problemas emocionais causados ​​pelo assassinato de sua namorada. Seu cargo agora é ocupado por seu melhor amigo David Rossi</li>
            </div>

          </div>


          <div class="campo">

            <div class="foto">
              <img src="./assets/img/Kate.webp" alt="kate">
            </div>

            <div class="descricao">
              <li>O Personagem <b>Kate Callahan</b> é uma agente experiente do FBI que se junta ao BAU durante o episódio de estreia da décima temporada depois que Alex Blake deixou o BAU. Ela então deixou o time no final da temporada devido à gravidez.  </li>
            </div>

          </div>

        </div>


        <div id= "votacao" class="conteinerVotacao" style="border-bottom: 2px solid #fff;" id="id_votacao">

          <h3>FAÇA SUA VOTAÇÃO, DE QUEM VOCÊ GOSTA MAIS</h3>

          <div class="voto">

            <form id="id_votacao" onsubmit="return publicarVotos()">
              <div id="div_voto" class="img_votos"></div>
              <button>Enviar</button>
            </form>

          </div>
        </div>

        <div class="mural_votos">
          <div id="numero_votos" class="numero_votos">

          </div>
        </div>
      </div>

      <h2>CAPA DAS TEMPORADAS</h2>
      <div class="carrossel" id="serie">
        
        <div id="id_carrossel" class="campo_carrossel">

        </div>
      </div>

      

      <!--MURAL DE AVISO -->

      <form id="form_postagem" method="post" onsubmit="return publicar()" class="campo_comentario">

        <label>
          Título do seu comentario:
          <br>
          <input name="titulo" id="titulo" maxlength="100" type="text">
        </label>

        <br>

        <label>
          Descrição (máximo de 250 caracteres):
          <br>
          <textarea name="descricao" id="textarea_descricao" maxlength="250" rows="5"></textarea>
        </label>

        <br>
        <button>Enviar</button>

      </form>


      <h1>Mural de Avisos</h1>

      <div class="div-results">
        <div id="feed_container" class="feed-container">
        </div>
      </div>
    </div>

    
  </main>
  <!-- FOOTER/RODAPÉ  -->
  <footer>

    <div class="rodape">
      <p>Criminal Minds&copy;</p>
    </div>

  </footer>


</body>

</html>


<script>
  // carrossel


  const imagem_carrossel =
    [
      "./assets/./img/T1.webp"
      ,
      "./assets/./img/T2.webp"
      ,
      "./assets/./img/T3.webp"
      ,
      "./assets/./img/T4.webp"
      ,
      "./assets/./img/T5.webp"
      ,
      "./assets/./img/T6.webp"
      ,
      "./assets/./img/T7.webp"
      ,
      "./assets/./img/T8.webp"
      ,
      "./assets/./img/T9.webp"
      ,
      "./assets/./img/T10.webp"
      ,
      "./assets/./img/T11.webp"
      ,
      "./assets/./img/T12.webp"
      ,
      "./assets/./img/T13.webp"
      ,
      "./assets/./img/T14.webp"
      ,
      "./assets/./img/T15.webp"
    ];

  var intervalo = 0;

  function carrosselfun() {

    
    if(intervalo >= imagem_carrossel.length){
      intervalo = 0;
    } 
    
    id_carrossel.innerHTML = `<img src="${imagem_carrossel[intervalo]}">`;
    intervalo ++

    console.log(intervalo);  
      //imagem_carrossel.style.transform = `translateX(${-intervalo*200}px)`;
  }

  setInterval(carrosselfun, 2000);

</script>



<!-- COMENTARIO -->
<script>
  b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

  function limparFormulario() {
    document.getElementById("form_postagem").reset();
  }

  function publicar() {
    var idUsuario = sessionStorage.ID_USUARIO;

    var corpo = {
      titulo: form_postagem.titulo.value,
      descricao: form_postagem.descricao.value
    }

    fetch(`/avisos/publicar/${idUsuario}`, {
      method: "post",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(corpo)
    }).then(function (resposta) {

      console.log("resposta: ", resposta);

      if (resposta.ok) {
        window.alert("Post realizado com sucesso pelo usuario de ID: " + idUsuario + "!");
        window.location = "./historia.html";
        limparFormulario();
        finalizarAguardar();
      } else if (resposta.status == 404) {
        window.alert("Deu 404!");
      } else {
        throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
      //finalizarAguardar();
    });

    return false;

  }

  function editar(idAviso) {
    sessionStorage.ID_POSTAGEM_EDITANDO = idAviso;
    console.log("cliquei em editar - " + idAviso);
    window.alert("Você será redirecionado à página de edição do aviso de id número: " + idAviso);
    window.location = "/dashboard/edicao-aviso.html"

  }

  function deletar(idAviso) {
    console.log("Criar função de apagar post escolhido - ID" + idAviso);
    fetch(`/avisos/deletar/${idAviso}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json"
      }
    }).then(function (resposta) {

      if (resposta.ok) {
        window.alert("Post deletado com sucesso pelo usuario de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
        window.location = "/historia.html"
      } else if (resposta.status == 404) {
        window.alert("Deu 404!");
      } else {
        throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
    });
  }

  function atualizarFeedcomentario() {
    //aguardar();
    fetch("/avisos/listar").then(function (resposta) {
      if (resposta.ok) {
        if (resposta.status == 204) {
          var feed = document.getElementById("feed_container");
          var mensagem = document.createElement("span");
          mensagem.innerHTML = "Nenhum resultado encontrado."
          feed.appendChild(mensagem);
          throw "Nenhum resultado encontrado!!";
        }

        resposta.json().then(function (resposta) {
          console.log("Dados recebidos: ", JSON.stringify(resposta));

          var feed = document.getElementById("feed_container");
          feed.innerHTML = "";
          for (let i = 0; i < resposta.length; i++) {
            var publicacao = resposta[i];

            // criando e manipulando elementos do HTML via JavaScript
            var divPublicacao = document.createElement("div");
            var spanID = document.createElement("span");
            var spanTitulo = document.createElement("span");
            var spanNome = document.createElement("span");
            var divDescricao = document.createElement("div");
            var divButtons = document.createElement("div");
            var btnEditar = document.createElement("button");
            var btnDeletar = document.createElement("button");


            spanID.innerHTML = "ID: <b> " + publicacao.idAviso + " </b> ";
            spanTitulo.innerHTML = "Título: <b> " + publicacao.titulo + " </b> ";
            spanNome.innerHTML = "Autor: <b> " + publicacao.nome + " </b> ";
            divDescricao.innerHTML = "Descrição: <b> " + publicacao.descricao + "</b> ";
            btnDeletar.innerHTML = "Deletar";

            divPublicacao.className = "publicacao";
            spanTitulo.id = "inputNumero" + publicacao.idAviso;
            spanNome.className = "publicacao-nome";
            spanTitulo.className = "publicacao-titulo";
            divDescricao.className = "publicacao-descricao";

            divButtons.className = "div-buttons"

            btnDeletar.className = "publicacao-btn-editar"
            btnDeletar.id = "btnDeletar" + publicacao.idAviso;
            btnDeletar.setAttribute("onclick", `deletar(${publicacao.idAviso})`);

            divPublicacao.appendChild(spanID);
            divPublicacao.appendChild(spanNome);
            divPublicacao.appendChild(spanTitulo);
            divPublicacao.appendChild(divDescricao);
            divPublicacao.appendChild(divButtons);
            //divButtons.appendChild(btnEditar);
            divButtons.appendChild(btnDeletar);
            feed.appendChild(divPublicacao);
          }

          //finalizarAguardar();
        });
      } else {
        throw ('Houve um erro na API!');
      }
    }).catch(function (resposta) {
      console.error(resposta);
      //finalizarAguardar();
    });
  }

  function testar() {
    //aguardar();

    var formulario = new URLSearchParams(new FormData(document.getElementById("form_postagem")));

    var divResultado = document.getElementById("div_feed");

    divResultado.appendChild(document.createTextNode(formulario.get("descricao")));
    divResultado.innerHTML = formulario.get("descricao");

    //finalizarAguardar();

    return false;
  }


</script>

<script>
  // //VOTACAO

  const img_votos = [
    { id: 'um', nome: 'Aaron Hotchner', img: './assets/img/Aaron Hotchner.webp' },
    { id: 'dois', nome: 'David-Rossi', img: './assets/img/David-Rossi.jpg' },
    { id: 'tres', nome: 'Space', img: './assets/img/Space.jpg' },
    { id: 'quatro', nome: 'penelope garcia', img: './assets/img/penelopegarcia.jpg' },
    { id: 'cinco', nome: 'Darick-Morgan', img: './assets/img/Darick-Morgan.jpg' },
    { id: 'seis', nome: 'Emilly', img: './assets/img/Emilly.webp' },
    { id: 'sete', nome: 'JJ', img: './assets/img/JJ.webp' },
    { id: 'oito', nome: 'Jason', img: './assets/img/Jason.jpg' },
    { id: 'nove', nome: 'Kate', img: './assets/img/Kate.webp' }
  ]

  for (var q = 0; q < img_votos.length; q++) {
    div_voto.innerHTML += `<img onclick="verificar${img_votos[q].id}()" src="${img_votos[q].img}" alt="${img_votos[q].nome}">`
  }

  var nome_pessonagem = "";
  var quantidade = "";


  function verificarum() {
    nome_pessonagem = 'Aaron Hotchner'
    quantidade = '1';
  }
  function verificardois() {
    nome_pessonagem = 'David-Rossi'
    quantidade = '1';
  }
  function verificartres() {
    nome_pessonagem = 'Space'
    quantidade = '1';
  }
  function verificarquatro() {
    nome_pessonagem = 'Penelope Garcia'
    quantidade = '1';
  }
  function verificarcinco() {
    nome_pessonagem = 'Darick-Morgan'
    quantidade = '1';
  }
  function verificarseis() {
    nome_pessonagem = 'Emilly'
    quantidade = '1';
  }
  function verificarsete() {
    nome_pessonagem = 'JJ'
    quantidade = '1';
  }
  function verificaroito() {
    nome_pessonagem = 'Jason'
    quantidade = '1';
  }
  function verificarnove() {
    nome_pessonagem = 'Kate'
    quantidade = '1';
  }


  function publicarVotos() {
    var idUsuario = sessionStorage.ID_USUARIO;

    if (nome_pessonagem == "") {
      alert(`escolha um personagem`)
      return false;
    }
    else {

      var corpo = {
        nome: nome_pessonagem,
        numero: quantidade
      };

      fetch(`/votos/publicar/${idUsuario}`, {
        method: "post",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(corpo)
      }).then(function (resposta) {

        console.log("resposta: ", resposta);

        if (resposta.ok) {
          window.alert("Post realizado com sucesso pelo usuario de ID: " + idUsuario + "!");
          window.location = "/historia.html";
          limparFormulario();
          finalizarAguardar();
        } else if (resposta.status == 404) {
          window.alert("Deu 404!");
        } else {
          alert(`você ja realizou um voto, nao pode votar novamente`)
          throw ("Houve um erro ao tentar realizar o voto! Código da resposta: " + resposta.status);
        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        //finalizarAguardar();
      });

      return false;
    }

  }

  function atualizarFeedvotos() {
    //aguardar();
    console.log('entrei na função');
    fetch("/votos/listar").then(function (resposta) {
      if (resposta.ok) {
        if (resposta.status == 204) {
          var feed = document.getElementById("numero_votos");
          var mensagem = document.createElement("span");
          mensagem.innerHTML = "Nenhum resultado encontrado."
          feed.appendChild(mensagem);
          throw "Nenhum resultado encontrado!!";
        }

        resposta.json().then(function (resposta) {
          console.log("Dados recebidos: ", JSON.stringify(resposta));

          var feed = document.getElementById("numero_votos");
          feed.innerHTML = "";
          for (let i = 0; i < resposta.length; i++) {
            var publicacao = resposta[i];


            // criando e manipulando elementos do HTML via JavaScript
            var divPublicacao = document.createElement("div");
            var spanTitulo = document.createElement("span");
            var porcentagem = publicacao.soma /9;
            spanTitulo.innerHTML = img_votos[i].nome + "<br>" + porcentagem.toFixed(1) + "%";
            
            spanTitulo.className = "publicacao-titulo";
            divPublicacao.appendChild(spanTitulo);
      
            feed.appendChild(spanTitulo);
          }

          //finalizarAguardar();
        });
      } else {
        throw ('Houve um erro na API!');
      }
    }).catch(function (resposta) {
      console.error(resposta);
      //finalizarAguardar();
    });
  }

  function testar() {
    //aguardar();

    var formulario = new URLSearchParams(new FormData(document.getElementById("id_votacao")));

    var divResultado = document.getElementById("div_numeo");

    divResultado.appendChild(document.createTextNode(formulario.get("numero")));
    divResultado.innerHTML = formulario.get("numero");

    //finalizarAguardar();

    return false;
  }


</script>